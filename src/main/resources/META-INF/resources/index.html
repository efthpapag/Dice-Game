<!DOCTYPE html>
<html lang="en">
<head>
  <title>Dice Game</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header id="header">
  <nav class="right">
    <a href="register.html" class="button alt">Sign-up</a>
  </nav>
</header>
<section id="banner">
  <div class="content">
    <form id="login" class="needs-validation" novalidate>
      <label class="form-label" for="username">Username</label>
      <input type="text" id="username" class="form-control"/><br>
      <label class="form-label" for="password">Password</label>
      <input type="password" id="password" class="form-control"/><br>
      <button type="submit" onclick="onClickSubmit()">Log in</button>
    </form>
  </div>
</section>
</body>
<script>
  // Fetch the login form
  var form = document.querySelector('form.needs-validation');

  // Prevent form submission and handle validation
  form.addEventListener('submit', function(event) {
    event.preventDefault();

    /*if (form.checkValidity() === false) {
      event.stopPropagation();
    } else {

    }*/

    form.classList.add('was-validated');
  });
  function onClickSubmit(){
    let username = document.getElementById('username');
    let password = document.getElementById('password');
    var myHeaders = new Headers()
    myHeaders.append("Accept", "*/*")
    myHeaders.append("Content-type", "application/json")

    var requestOptions = {
      method: 'POST',
      //mode : 'cors',
      headers: myHeaders,
      body: JSON.stringify({
        "username": username.value,
        "password": password.value
      })
    };
    fetch("https://localhost:8443/users/login", requestOptions)
            .then(async response => {
              const isJson = response.headers.get('content-type')?.includes('application/json');
              const data = isJson && await response.json();
              if(response.status === 200){

                var jwt = data.value;
                sessionStorage.setItem("jwt", jwt);
                window.location = "https://localhost:8443/rollTheDice.html";
              }else{
                alert("Check your credentials");
              }
            })
  }
</script>
</html>